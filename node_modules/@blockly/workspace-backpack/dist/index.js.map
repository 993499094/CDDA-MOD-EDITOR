{"version":3,"file":"index.js","mappings":"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","sources":["webpack://@blockly/workspace-backpack/webpack/universalModuleDefinition","webpack://@blockly/workspace-backpack/external umd {\"root\":\"Blockly\",\"commonjs\":\"blockly/core\",\"commonjs2\":\"blockly/core\",\"amd\":\"blockly/core\"}","webpack://@blockly/workspace-backpack/webpack/bootstrap","webpack://@blockly/workspace-backpack/webpack/runtime/define property getters","webpack://@blockly/workspace-backpack/webpack/runtime/hasOwnProperty shorthand","webpack://@blockly/workspace-backpack/webpack/runtime/make namespace object","webpack://@blockly/workspace-backpack/./src/msg.js","webpack://@blockly/workspace-backpack/./src/ui_events.js","webpack://@blockly/workspace-backpack/./src/backpack.js","webpack://@blockly/workspace-backpack/./src/options.js","webpack://@blockly/workspace-backpack/./src/backpack_helpers.js"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory(require(\"blockly/core\"));\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([\"blockly/core\"], factory);\n\telse {\n\t\tvar a = typeof exports === 'object' ? factory(require(\"blockly/core\")) : factory(root[\"Blockly\"]);\n\t\tfor(var i in a) (typeof exports === 'object' ? exports : root)[i] = a[i];\n\t}\n})(this, (__WEBPACK_EXTERNAL_MODULE__573__) => {\nreturn ","module.exports = __WEBPACK_EXTERNAL_MODULE__573__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Translatable messages used in backpack.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\nimport * as Blockly from 'blockly/core';\n\n/** @type {string} */\n// context menu - Copy all Blocks on the workspace to the backpack.\nBlockly.Msg['COPY_ALL_TO_BACKPACK'] = 'Copy All Blocks to Backpack';\n/** @type {string} */\n// context menu - Copy the selected Block to the backpack.\nBlockly.Msg['COPY_TO_BACKPACK'] = 'Copy to Backpack';\n/** @type {string} */\n// context menu - Empty the backpack.\nBlockly.Msg['EMPTY_BACKPACK'] = 'Empty';\n/** @type {string} */\n// context menu - Paste all Blocks from the backpack to the workspace.\nBlockly.Msg['PASTE_ALL_FROM_BACKPACK'] = 'Paste All Blocks from Backpack';\n/** @type {string} */\n// context menu - Remove the selected Block from the backpack.\nBlockly.Msg['REMOVE_FROM_BACKPACK'] = 'Remove from Backpack';\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview UI events used for the backpack plugin.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\nimport * as Blockly from 'blockly/core';\n\n/**\n * Name of event that records a backpack open.\n * @const\n */\nexport const BACKPACK_OPEN = 'backpack_open';\n\n/**\n * A UI event representing a backpack opening or closing.\n */\nexport class BackpackOpen extends Blockly.Events.UiBase {\n  /**\n   * Class for a backpack open event.\n   * @param {boolean=} isOpen Whether the backpack flyout is opening (false\n   *    if closing). Undefined for a blank event.\n   * @param {string=} workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   * @extends {Blockly.Events.UiBase}\n   * @constructor\n   */\n  constructor(isOpen, workspaceId) {\n    super(workspaceId);\n\n    /**\n     * Whether the backpack flyout is opening (false if closing).\n     * @type {boolean|undefined}\n     */\n    this.isOpen = isOpen;\n\n    /**\n     * Type of this event.\n     * @type {string}\n     */\n    this.type = BACKPACK_OPEN;\n  }\n\n  /**\n   * Encode the event as JSON.\n   * @returns {!Object} JSON representation.\n   */\n  toJson() {\n    const json = super.toJson();\n    json['isOpen'] = this.isOpen;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   * @param {!Object} json JSON representation.\n   */\n  fromJson(json) {\n    super.fromJson(json);\n    this.isOpen = json['isOpen'];\n  }\n}\n\nBlockly.registry.register(Blockly.registry.Type.EVENT, BACKPACK_OPEN,\n    BackpackOpen);\n\n/**\n * Name of event that records a backpack change.\n * @const\n */\nexport const BACKPACK_CHANGE = 'backpack_change';\n\n/**\n * A UI event representing a change in a backpack's contents.\n */\nexport class BackpackChange extends Blockly.Events.UiBase {\n  /**\n   * Class for a backpack change event.\n   * @param {string=} workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   * @extends {Blockly.Events.UiBase}\n   * @constructor\n   */\n  constructor(workspaceId) {\n    super(workspaceId);\n\n    /**\n     * Type of this event.\n     * @type {string}\n     */\n    this.type = BACKPACK_CHANGE;\n  }\n}\n\nBlockly.registry.register(Blockly.registry.Type.EVENT, BACKPACK_CHANGE,\n    BackpackChange);\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview A backpack that lives on top of the workspace.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\nimport * as Blockly from 'blockly/core';\nimport {cleanBlockXML, registerContextMenus} from './backpack_helpers';\nimport {BackpackChange, BackpackOpen} from './ui_events';\nimport {BackpackContextMenuOptions, BackpackOptions, parseOptions} from './options';\n\n/**\n * Class for backpack that can be used save blocks from the workspace for\n * future use.\n * @param {!Blockly.WorkspaceSvg} workspace The workspace to sit in.\n * @implements {Blockly.IAutoHideable}\n * @implements {Blockly.IPositionable}\n * @extends {Blockly.DragTarget}\n */\nexport class Backpack extends Blockly.DragTarget {\n  /**\n   * Constructor for a backpack.\n   * @param {!Blockly.WorkspaceSvg} targetWorkspace The target workspace that\n   *     the backpack will be added to.\n   * @param {!BackpackOptions=} backpackOptions The backpack options to use.\n   */\n  constructor(targetWorkspace, backpackOptions) {\n    super();\n\n    /**\n     * The workspace.\n     * @type {!Blockly.WorkspaceSvg}\n     * @protected\n     */\n    this.workspace_ = targetWorkspace;\n\n    /**\n     * The unique id for this component.\n     * @type {string}\n     */\n    this.id = 'backpack';\n\n    /**\n     * The backpack options.\n     * @type {!BackpackOptions}\n     */\n    this.options_ = parseOptions(backpackOptions);\n\n    /**\n     * The backpack flyout. Initialized during init.\n     * @type {?Blockly.IFlyout}\n     * @protected\n     */\n    this.flyout_ = null;\n\n    /**\n     * A list of XML (stored as strings) representing blocks in the backpack.\n     * @type {!Array<string>}\n     * @protected\n     */\n    this.contents_ = [];\n\n    /**\n     * Array holding info needed to unbind events.\n     * Used for disposing.\n     * @type {!Array<!Blockly.browserEvents.Data>}\n     * @private\n     */\n    this.boundEvents_ = [];\n\n    /**\n     * Left coordinate of the backpack.\n     * @type {number}\n     * @protected\n     */\n    this.left_ = 0;\n\n    /**\n     * Top coordinate of the backpack.\n     * @type {number}\n     * @protected\n     */\n    this.top_ = 0;\n\n    /**\n     * Width of the backpack. Used for clip path.\n     * @type {number}\n     * @const\n     * @protected\n     */\n    this.WIDTH_ = 40;\n\n    /**\n     * Height of the backpack. Used for clip path.\n     * @type {number}\n     * @const\n     * @protected\n     */\n    this.HEIGHT_ = 60;\n\n    /**\n     * Distance between backpack and bottom or top edge of workspace.\n     * @type {number}\n     * @const\n     * @protected\n     */\n    this.MARGIN_VERTICAL_ = 20;\n\n    /**\n     * Distance between backpack and right or left edge of workspace.\n     * @type {number}\n     * @const\n     * @protected\n     */\n    this.MARGIN_HORIZONTAL_ = 20;\n\n    /**\n     * Extent of hotspot on all sides beyond the size of the image.\n     * @const {number}\n     * @protected\n     */\n    this.HOTSPOT_MARGIN_ = 10;\n\n    /**\n     * The SVG group containing the backpack.\n     * @type {?SVGElement}\n     * @protected\n     */\n    this.svgGroup_ = null;\n\n    /**\n     * Top offset for backpack in svg.\n     * @type {number}\n     * @private\n     */\n    this.SPRITE_TOP_ = 10;\n\n    /**\n     * Left offset for backpack in svg.\n     * @type {number}\n     * @private\n     */\n    this.SPRITE_LEFT_ = 20;\n\n    /**\n     * Width/Height of svg.\n     * @type {number}\n     * @const\n     * @private\n     */\n    this.SPRITE_SIZE_ = 80;\n  }\n\n  /**\n   * Initializes the backpack.\n   */\n  init() {\n    this.workspace_.getComponentManager().addComponent({\n      component: this,\n      weight: 2,\n      capabilities: [\n        Blockly.ComponentManager.Capability.AUTOHIDEABLE,\n        Blockly.ComponentManager.Capability.DRAG_TARGET,\n        Blockly.ComponentManager.Capability.POSITIONABLE,\n      ],\n    });\n    this.initFlyout_();\n    this.createDom_();\n    this.attachListeners_();\n    registerContextMenus(\n        /** @type {!BackpackContextMenuOptions} */ this.options_.contextMenu,\n        this.workspace_);\n    this.initialized_ = true;\n    this.workspace_.resize();\n  }\n\n  /**\n   * Disposes of workspace search.\n   * Unlink from all DOM elements and remove all event listeners\n   * to prevent memory leaks.\n   */\n  dispose() {\n    if (this.svgGroup_) {\n      Blockly.utils.dom.removeNode(this.svgGroup_);\n    }\n    for (const event of this.boundEvents_) {\n      Blockly.browserEvents.unbind(event);\n    }\n    this.boundEvents_.length = 0;\n  }\n\n  /**\n   * Creates and initializes the flyout and inserts it into the dom.\n   * @protected\n   */\n  initFlyout_() {\n    // Create flyout options.\n    const flyoutWorkspaceOptions = new Blockly.Options(\n        /** @type {!Blockly.BlocklyOptions} */\n        ({\n          'scrollbars': true,\n          'parentWorkspace': this.workspace_,\n          'rtl': this.workspace_.RTL,\n          'oneBasedIndex': this.workspace_.options.oneBasedIndex,\n          'renderer': this.workspace_.options.renderer,\n          'rendererOverrides': this.workspace_.options.rendererOverrides,\n          'move': {\n            'scrollbars': true,\n          },\n        }));\n    // Create vertical or horizontal flyout.\n    if (this.workspace_.horizontalLayout) {\n      flyoutWorkspaceOptions.toolboxPosition =\n          (this.workspace_.toolboxPosition ===\n              Blockly.utils.toolbox.Position.TOP) ?\n              Blockly.utils.toolbox.Position.BOTTOM :\n              Blockly.utils.toolbox.Position.TOP;\n      const HorizontalFlyout = Blockly.registry.getClassFromOptions(\n          Blockly.registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX,\n          this.workspace_.options, true);\n      this.flyout_ = new HorizontalFlyout(flyoutWorkspaceOptions);\n    } else {\n      flyoutWorkspaceOptions.toolboxPosition =\n          (this.workspace_.toolboxPosition ===\n              Blockly.utils.toolbox.Position.RIGHT) ?\n              Blockly.utils.toolbox.Position.LEFT :\n              Blockly.utils.toolbox.Position.RIGHT;\n      const VerticalFlyout = Blockly.registry.getClassFromOptions(\n          Blockly.registry.Type.FLYOUTS_VERTICAL_TOOLBOX,\n          this.workspace_.options, true);\n      this.flyout_ = new VerticalFlyout(flyoutWorkspaceOptions);\n    }\n    // Add flyout to DOM.\n    const parentNode = this.workspace_.getParentSvg().parentNode;\n    parentNode.appendChild(this.flyout_.createDom(Blockly.utils.Svg.SVG));\n    this.flyout_.init(this.workspace_);\n  }\n\n  /**\n   * Creates DOM for UI element.\n   * @protected\n   */\n  createDom_() {\n    this.svgGroup_ = Blockly.utils.dom.createSvgElement(\n        Blockly.utils.Svg.G, {}, null);\n    const rnd = Blockly.utils.idGenerator.genUid();\n    const clip = Blockly.utils.dom.createSvgElement(\n        Blockly.utils.Svg.CLIPPATH,\n        {'id': 'blocklyBackpackClipPath' + rnd},\n        this.svgGroup_);\n    Blockly.utils.dom.createSvgElement(\n        Blockly.utils.Svg.RECT,\n        {\n          'width': this.WIDTH_,\n          'height': this.HEIGHT_,\n        },\n        clip);\n    this.svgImg_ = Blockly.utils.dom.createSvgElement(\n        Blockly.utils.Svg.IMAGE,\n        {\n          'class': 'blocklyBackpack',\n          'clip-path': 'url(#blocklyBackpackClipPath' + rnd + ')',\n          'width': this.SPRITE_SIZE_ + 'px',\n          'x': -this.SPRITE_LEFT_,\n          'height': this.SPRITE_SIZE_ + 'px',\n          'y': -this.SPRITE_TOP_,\n        },\n        this.svgGroup_);\n    this.svgImg_.setAttributeNS(Blockly.utils.dom.XLINK_NS, 'xlink:href',\n        BACKPACK_SVG_DATAURI);\n\n    Blockly.utils.dom.insertAfter(\n        this.svgGroup_, this.workspace_.getBubbleCanvas());\n  }\n\n  /**\n   * Attaches event listeners.\n   * @protected\n   */\n  attachListeners_() {\n    this.addEvent_(\n        this.svgGroup_, 'mousedown', this, this.blockMouseDownWhenOpenable_);\n    this.addEvent_(\n        this.svgGroup_, 'mouseup', this, this.onClick_);\n    this.addEvent_(\n        this.svgGroup_, 'mouseover', this, this.onMouseOver_);\n    this.addEvent_(\n        this.svgGroup_, 'mouseout', this, this.onMouseOut_);\n  }\n\n  /**\n   * Helper method for adding an event.\n   * @param {!Element} node Node upon which to listen.\n   * @param {string} name Event name to listen to (e.g. 'mousedown').\n   * @param {Object} thisObject The value of 'this' in the function.\n   * @param {!Function} func Function to call when event is triggered.\n   * @private\n   */\n  addEvent_(node, name, thisObject, func) {\n    const event = Blockly.browserEvents.bind(node, name, thisObject, func);\n    this.boundEvents_.push(event);\n  }\n\n  /**\n   * Returns the backpack flyout.\n   * @returns {?Blockly.IFlyout} The backpack flyout.\n   * @public\n   */\n  getFlyout() {\n    return this.flyout_;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   * @returns {?Blockly.utils.Rect} The component's bounding box. Null if drag\n   *   target area should be ignored.\n   */\n  getClientRect() {\n    if (!this.svgGroup_) {\n      return null;\n    }\n\n    const clientRect = this.svgGroup_.getBoundingClientRect();\n    const top = clientRect.top + this.SPRITE_TOP_ - this.HOTSPOT_MARGIN_;\n    const bottom = top + this.HEIGHT_ + 2 * this.HOTSPOT_MARGIN_;\n    const left = clientRect.left + this.SPRITE_LEFT_ - this.HOTSPOT_MARGIN_;\n    const right = left + this.WIDTH_ + 2 * this.HOTSPOT_MARGIN_;\n    return new Blockly.utils.Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   * @returns {!Blockly.utils.Rect} The component’s bounding box.\n   */\n  getBoundingRectangle() {\n    return new Blockly.utils.Rect(\n        this.top_, this.top_ + this.HEIGHT_,\n        this.left_, this.left_ + this.WIDTH_);\n  }\n\n  /**\n   * Positions the backpack.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   * @param {!Blockly.MetricsManager.UiMetrics} metrics The workspace metrics.\n   * @param {!Array<!Blockly.utils.Rect>} savedPositions List of rectangles that\n   *     are already on the workspace.\n   */\n  position(metrics, savedPositions) {\n    if (!this.initialized_) {\n      return;\n    }\n    const hasVerticalScrollbars = this.workspace_.scrollbar &&\n        this.workspace_.scrollbar.canScrollHorizontally();\n    const hasHorizontalScrollbars = this.workspace_.scrollbar &&\n        this.workspace_.scrollbar.canScrollVertically();\n\n    if (metrics.toolboxMetrics.position === Blockly.TOOLBOX_AT_LEFT ||\n        (this.workspace_.horizontalLayout && !this.workspace_.RTL)) {\n      // Right corner placement.\n      this.left_ = metrics.absoluteMetrics.left + metrics.viewMetrics.width -\n          this.WIDTH_ - this.MARGIN_HORIZONTAL_;\n      if (hasVerticalScrollbars && !this.workspace_.RTL) {\n        this.left_ -= Blockly.Scrollbar.scrollbarThickness;\n      }\n    } else {\n      // Left corner placement.\n      this.left_ = this.MARGIN_HORIZONTAL_;\n      if (hasVerticalScrollbars && this.workspace_.RTL) {\n        this.left_ += Blockly.Scrollbar.scrollbarThickness;\n      }\n    }\n\n    const startAtBottom =\n        metrics.toolboxMetrics.position === Blockly.TOOLBOX_AT_BOTTOM;\n    if (startAtBottom) {\n      // Bottom corner placement\n      this.top_ = metrics.absoluteMetrics.top + metrics.viewMetrics.height -\n          this.HEIGHT_ - this.MARGIN_VERTICAL_;\n      if (hasHorizontalScrollbars) {\n        // The horizontal scrollbars are always positioned on the bottom.\n        this.top_ -= Blockly.Scrollbar.scrollbarThickness;\n      }\n    } else {\n      // Upper corner placement\n      this.top_ = metrics.absoluteMetrics.top + this.MARGIN_VERTICAL_;\n    }\n\n    // Check for collision and bump if needed.\n    let boundingRect = this.getBoundingRectangle();\n    for (let i = 0, otherEl; (otherEl = savedPositions[i]); i++) {\n      if (boundingRect.intersects(otherEl)) {\n        if (startAtBottom) { // Bump up.\n          this.top_ = otherEl.top - this.HEIGHT_ - this.MARGIN_VERTICAL_;\n        } else { // Bump down.\n          this.top_ = otherEl.bottom + this.MARGIN_VERTICAL_;\n        }\n        // Recheck other savedPositions\n        boundingRect = this.getBoundingRectangle();\n        i = -1;\n      }\n    }\n\n    this.svgGroup_.setAttribute('transform',\n        'translate(' + this.left_ + ',' + this.top_ + ')');\n  }\n\n  /**\n   * Returns the count of items in the backpack.\n   * @returns {number} The count of items.\n   */\n  getCount() {\n    return this.contents_.length;\n  }\n\n  /**\n   * Returns backpack contents.\n   * @returns {!Array<string>} The backpack contents.\n   */\n  getContents() {\n    // Return a shallow copy of the contents array.\n    return [...this.contents_];\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   * @param {!Blockly.IDraggable} dragElement The block or bubble currently\n   *   being dragged.\n   */\n  onDrop(dragElement) {\n    if (dragElement instanceof Blockly.BlockSvg) {\n      this.addBlock(/** @type {!Blockly.BlockSvg} */ (dragElement));\n    }\n  }\n  /**\n   * Converts the provided block into a cleaned XML string.\n   * @param {!Blockly.Block} block The block to convert.\n   * @returns {string} The cleaned XML string.\n   * @private\n   */\n  blockToCleanXmlString_(block) {\n    return cleanBlockXML(Blockly.Xml.blockToDom(block));\n  }\n\n  /**\n   * Returns whether the backpack contains a duplicate of the provided Block.\n   * @param {!Blockly.Block} block The block to check.\n   * @returns {boolean} Whether the backpack contains a duplicate of the\n   *     provided block.\n   */\n  containsBlock(block) {\n    const cleanedBlockXml = this.blockToCleanXmlString_(block);\n    return this.contents_.indexOf(cleanedBlockXml) !== -1;\n  }\n\n  /**\n   * Adds the specified block to backpack.\n   * @param {!Blockly.Block} block The block to be added to the backpack.\n   */\n  addBlock(block) {\n    this.addItem(this.blockToCleanXmlString_(block));\n  }\n\n\n  /**\n   * Adds the provided blocks to backpack.\n   * @param {!Array<!Blockly.Block>} blocks The blocks to be added to the\n   *     backpack.\n   */\n  addBlocks(blocks) {\n    const cleanedBlocks = blocks.map(this.blockToCleanXmlString_);\n    this.addItems(cleanedBlocks);\n  }\n\n\n  /**\n   * Removes the specified block from the backpack.\n   * @param {!Blockly.Block} block The block to be removed from the backpack.\n   */\n  removeBlock(block) {\n    this.removeItem(this.blockToCleanXmlString_(block));\n  }\n\n  /**\n   * Adds item to backpack.\n   * @param {string} item Text representing the XML tree of a block to add,\n   *     cleaned of all unnecessary attributes.\n   */\n  addItem(item) {\n    this.addItems([item]);\n  }\n\n  /**\n   * Adds multiple items to the backpack.\n   * @param {!Array<string>} items The backpack contents to add.\n   */\n  addItems(items) {\n    const addedItems = this.filterDuplicates_(items);\n    if (addedItems.length) {\n      this.contents_.unshift(...addedItems);\n      this.onContentChange_();\n    }\n  }\n\n  /**\n   * Removes item from the backpack.\n   * @param {string} item Text representing the XML tree of a block to remove,\n   * cleaned of all unnecessary attributes.\n   */\n  removeItem(item) {\n    const itemIndex = this.contents_.indexOf(item);\n    if (itemIndex !== -1) {\n      this.contents_.splice(itemIndex, 1);\n      this.onContentChange_();\n    }\n  }\n\n  /**\n   * Sets backpack contents.\n   * @param {!Array<string>} contents The new backpack contents.\n   */\n  setContents(contents) {\n    this.contents_ = [];\n    this.contents_ = this.filterDuplicates_(contents);\n    this.onContentChange_();\n  }\n\n  /**\n   * Empties the backpack's contents. If the contents-flyout is currently open\n   * it will be closed.\n   */\n  empty() {\n    if (!this.getCount()) {\n      return;\n    }\n    if (this.contents_.length) {\n      this.contents_ = [];\n      this.onContentChange_();\n    }\n    this.close();\n  }\n\n  /**\n   * Handles content change.\n   * @protected\n   */\n  onContentChange_() {\n    this.maybeRefreshFlyoutContents_();\n    Blockly.Events.fire(new BackpackChange(this.workspace_.id));\n\n    if (!this.options_.useFilledBackpackImage) return;\n    if (this.contents_.length > 0) {\n      this.svgImg_.setAttributeNS(Blockly.utils.dom.XLINK_NS, 'xlink:href',\n          BACKPACK_FILLED_SVG_DATAURI);\n    } else {\n      this.svgImg_.setAttributeNS(Blockly.utils.dom.XLINK_NS, 'xlink:href',\n          BACKPACK_SVG_DATAURI);\n    }\n  }\n\n  /**\n   * Returns a filtered list without duplicates within itself and without any\n   * shared elements with this.contents_.\n   * @param {!Array<string>} array The array of items to filter.\n   * @returns {!Array<string>} The filtered list.\n   * @private\n   */\n  filterDuplicates_(array) {\n    return array.filter((item, idx) => {\n      return array.indexOf(item) === idx && this.contents_.indexOf(item) === -1;\n    });\n  }\n\n  /**\n   * Returns whether the backpack is open-able.\n   * @returns {boolean} Whether the backpack is open-able.\n   * @protected\n   */\n  isOpenable_() {\n    return !this.isOpen() &&\n    this.options_.allowEmptyBackpackOpen ? true : this.getCount() > 0;\n  }\n\n  /**\n   * Returns whether the backpack is open.\n   * @returns {boolean} Whether the backpack is open.\n   */\n  isOpen() {\n    return this.flyout_.isVisible();\n  }\n\n  /**\n   * Opens the backpack flyout.\n   */\n  open() {\n    if (!this.isOpenable_()) {\n      return;\n    }\n    const xml = this.contents_.map((text) => Blockly.Xml.textToDom(text));\n    this.flyout_.show(xml);\n    Blockly.Events.fire(new BackpackOpen(true, this.workspace_.id));\n  }\n\n  /**\n   * Refreshes backpack flyout contents if the flyout is open.\n   * @protected\n   */\n  maybeRefreshFlyoutContents_() {\n    if (!this.isOpen()) {\n      return;\n    }\n    const xml = this.contents_.map((text) => Blockly.Xml.textToDom(text));\n    this.flyout_.show(xml);\n  }\n\n  /**\n   * Closes the backpack flyout.\n   */\n  close() {\n    if (!this.isOpen()) {\n      return;\n    }\n    this.flyout_.hide();\n    Blockly.Events.fire(new BackpackOpen(false, this.workspace_.id));\n  }\n\n  /**\n   * Hides the component. Called in Blockly.hideChaff.\n   * @param {boolean} onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups) {\n    // The backpack flyout always autocloses because it overlays the backpack UI\n    // (no backpack to click to close it).\n    if (!onlyClosePopups) {\n      this.close();\n    }\n  }\n\n  /**\n   * Handle click event.\n   * @param {!MouseEvent} e Mouse event.\n   * @protected\n   */\n  onClick_(e) {\n    if (Blockly.browserEvents.isRightButton(e)) {\n      return;\n    }\n    this.open();\n    const uiEvent = new (Blockly.Events.get(Blockly.Events.CLICK))(\n        null, this.workspace_.id, 'backpack');\n    Blockly.Events.fire(uiEvent);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   * @param {!Blockly.IDraggable} dragElement The block or bubble currently\n   *   being dragged.\n   */\n  onDragEnter(dragElement) {\n    if (dragElement instanceof Blockly.BlockSvg) {\n      this.updateHoverStying_(true);\n    }\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   * @param {!Blockly.IDraggable} _dragElement The block or bubble currently\n   *   being dragged.\n   */\n  onDragExit(_dragElement) {\n    this.updateHoverStying_(false);\n  }\n\n  /**\n   * Handles a mouseover event.\n   * @private\n   */\n  onMouseOver_() {\n    if (this.isOpenable_()) {\n      this.updateHoverStying_(true);\n    }\n  }\n\n  /**\n   * Handles a mouseout event.\n   * @private\n   */\n  onMouseOut_() {\n    this.updateHoverStying_(false);\n  }\n\n  /**\n   * Adds or removes styling to darken the backpack to show it is interactable.\n   * @param {boolean} addClass True to add styling, false to remove.\n   * @protected\n   */\n  updateHoverStying_(addClass) {\n    const backpackDarken = 'blocklyBackpackDarken';\n    if (addClass) {\n      Blockly.utils.dom.addClass(\n          /** @type {!SVGElement} */ (this.svgImg_), backpackDarken);\n    } else {\n      Blockly.utils.dom.removeClass(\n          /** @type {!SVGElement} */ (this.svgImg_), backpackDarken);\n    }\n  }\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   * @param {!Blockly.IDraggable} dragElement The block or bubble currently\n   *   being dragged.\n   * @returns {boolean} Whether the block or bubble provided should be returned\n   *   to drag start.\n   */\n  shouldPreventMove(dragElement) {\n    return dragElement instanceof Blockly.BlockSvg;\n  }\n\n  /**\n   * Prevents a workspace scroll and click event if the backpack is openable.\n   * @param {!Event} e A mouse down event.\n   * @protected\n   */\n  blockMouseDownWhenOpenable_(e) {\n    if (!Blockly.browserEvents.isRightButton(e) && this.isOpenable_()) {\n      e.stopPropagation(); // Don't start a workspace scroll.\n    }\n  }\n}\n\n/**\n * Base64 encoded data uri for backpack  icon.\n * @type {string}\n */\nconst BACKPACK_SVG_DATAURI =\n    'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC' +\n    '9zdmciIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDI0IDI0IiBoZWlnaHQ9IjI0cHgiIH' +\n    'ZpZXdCb3g9IjAgMCAyNCAyNCIgd2lkdGg9IjI0cHgiIGZpbGw9IiM0NTVBNjQiPjxnPjxyZW' +\n    'N0IGZpbGw9Im5vbmUiIGhlaWdodD0iMjQiIHdpZHRoPSIyNCIvPjwvZz48Zz48Zy8+PGc+PH' +\n    'BhdGggZD0iTTEzLjk3LDUuMzRDMTMuOTgsNS4yMywxNCw1LjEyLDE0LDVjMC0xLjEtMC45LT' +\n    'ItMi0ycy0yLDAuOS0yLDJjMCwwLjEyLDAuMDIsMC4yMywwLjAzLDAuMzRDNy42OSw2LjE1LD' +\n    'YsOC4zOCw2LDExdjggYzAsMS4xLDAuOSwyLDIsMmg4YzEuMSwwLDItMC45LDItMnYtOEMxOC' +\n    'w4LjM4LDE2LjMxLDYuMTUsMTMuOTcsNS4zNHogTTExLDVjMC0wLjU1LDAuNDUtMSwxLTFzMS' +\n    'wwLjQ1LDEsMSBjMCwwLjAzLTAuMDEsMC4wNi0wLjAyLDAuMDlDMTIuNjYsNS4wMywxMi4zNC' +\n    'w1LDEyLDVzLTAuNjYsMC4wMy0wLjk4LDAuMDlDMTEuMDEsNS4wNiwxMSw1LjAzLDExLDV6IE' +\n    '0xNiwxM3YxdjAuNSBjMCwwLjI4LTAuMjIsMC41LTAuNSwwLjVTMTUsMTQuNzgsMTUsMTQuNV' +\n    'YxNHYtMUg4di0xaDdoMVYxM3oiLz48L2c+PC9nPjwvc3ZnPg==';\n\n/**\n * Base64 encoded data uri for backpack  icon when filled.\n * @type {string}\n */\nconst BACKPACK_FILLED_SVG_DATAURI = 'data:image/svg+xml;base64,PD94bWwgdmVyc2' +\n    'lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+CjwhLS0gQ3JlYX' +\n    'RlZCB3aXRoIElua3NjYXBlIChodHRwOi8vd3d3Lmlua3NjYXBlLm9yZy8pIC0tPgoKPHN2Zw' +\n    'ogICB3aWR0aD0iMjQiCiAgIGhlaWdodD0iMjQiCiAgIHZpZXdCb3g9IjAgMCAyNCAyNCIKIC' +\n    'AgdmVyc2lvbj0iMS4xIgogICBpZD0ic3ZnNSIKICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3' +\n    'JnLzIwMDAvc3ZnIgogICB4bWxuczpzdmc9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj' +\n    '4KICA8ZGVmcwogICAgIGlkPSJkZWZzMiIgLz4KICA8ZwogICAgIGlkPSJsYXllcjEiPgogIC' +\n    'AgPGcKICAgICAgIHN0eWxlPSJmaWxsOiM0NTVhNjQiCiAgICAgICBpZD0iZzg0OCIKICAgIC' +\n    'AgIHRyYW5zZm9ybT0ibWF0cml4KDAuMjY0NTgzMzMsMCwwLDAuMjY0NTgzMzMsOC44MjQ5OT' +\n    'k3LDguODI0OTk5NykiPgogICAgICA8ZwogICAgICAgICBpZD0iZzgyNiI+CiAgICAgICAgPH' +\n    'JlY3QKICAgICAgICAgICBmaWxsPSJub25lIgogICAgICAgICAgIGhlaWdodD0iMjQiCiAgIC' +\n    'AgICAgICAgd2lkdGg9IjI0IgogICAgICAgICAgIGlkPSJyZWN0ODI0IgogICAgICAgICAgIH' +\n    'g9IjAiCiAgICAgICAgICAgeT0iMCIgLz4KICAgICAgPC9nPgogICAgICA8ZwogICAgICAgIC' +\n    'BpZD0iZzgzNCI+CiAgICAgICAgPGcKICAgICAgICAgICBpZD0iZzgyOCIgLz4KICAgICAgIC' +\n    'A8ZwogICAgICAgICAgIGlkPSJnMjIyMyI+CiAgICAgICAgICA8ZwogICAgICAgICAgICAgaW' +\n    'Q9ImcyMTAxNiI+CiAgICAgICAgICAgIDxnCiAgICAgICAgICAgICAgIHN0eWxlPSJmaWxsOi' +\n    'M0NTVhNjQiCiAgICAgICAgICAgICAgIGlkPSJnMTQ5MyIKICAgICAgICAgICAgICAgdHJhbn' +\n    'Nmb3JtPSJtYXRyaXgoMy43Nzk1Mjc2LDAsMCwzLjc3OTUyNzYsLTMzLjM1NDMzLC0zMy4zNT' +\n    'QzMykiPgogICAgICAgICAgICAgIDxnCiAgICAgICAgICAgICAgICAgaWQ9ImcxNDcxIj4KIC' +\n    'AgICAgICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICAgICAgICBpZD0icmVjdDE0NjkiCi' +\n    'AgICAgICAgICAgICAgICAgICBzdHlsZT0iZmlsbDpub25lIgogICAgICAgICAgICAgICAgIC' +\n    'AgZD0iTSAwLDAgSCAyNCBWIDI0IEggMCBaIiAvPgogICAgICAgICAgICAgIDwvZz4KICAgIC' +\n    'AgICAgICAgICA8ZwogICAgICAgICAgICAgICAgIGlkPSJnMTQ3OSI+CiAgICAgICAgICAgIC' +\n    'AgICA8ZwogICAgICAgICAgICAgICAgICAgaWQ9ImcxNDczIiAvPgogICAgICAgICAgICAgIC' +\n    'AgPGcKICAgICAgICAgICAgICAgICAgIGlkPSJnMTQ3NyI+CiAgICAgICAgICAgICAgICAgID' +\n    'xwYXRoCiAgICAgICAgICAgICAgICAgICAgIGlkPSJwYXRoMTQ3NSIKICAgICAgICAgICAgIC' +\n    'AgICAgICAgZD0ibSAxMiwzIGMgLTEuMSwwIC0yLDAuOSAtMiwyIDAsMC4xMiAwLjAxOTMsMC' +\n    '4yMjk4NDM4IDAuMDI5MywwLjMzOTg0MzggQyA3LjY4OTI5NjUsNi4xNDk4NDMzIDYsOC4zOC' +\n    'A2LDExIHYgOCBjIDAsMS4xIDAuOSwyIDIsMiBoIDggYyAxLjEsMCAyLC0wLjkgMiwtMiBWID' +\n    'ExIEMgMTgsOC4zOCAxNi4zMTA3MDMsNi4xNDk4NDMzIDEzLjk3MDcwMyw1LjMzOTg0MzggMT' +\n    'MuOTgwNzAzLDUuMjI5ODQzOCAxNCw1LjEyIDE0LDUgMTQsMy45IDEzLjEsMyAxMiwzIFogbS' +\n    'AwLDEgYyAwLjU1LDAgMSwwLjQ1IDEsMSAwLDAuMDMgLTAuMDA5NSwwLjA1OTg0NCAtMC4wMT' +\n    'k1MywwLjA4OTg0NCBDIDEyLjY2MDQ2OSw1LjAyOTg0MzggMTIuMzQsNSAxMiw1IDExLjY2LD' +\n    'UgMTEuMzM5NTMxLDUuMDI5ODQzOCAxMS4wMTk1MzEsNS4wODk4NDM4IDExLjAwOTUzMSw1Lj' +\n    'A1OTg0MzggMTEsNS4wMyAxMSw1IDExLDQuNDUgMTEuNDUsNCAxMiw0IFogbSAtMy40NzI2NT' +\n    'YyLDYuMzk4NDM4IGggMS4xNTYyNSB2IDIuNjQwNjI0IGggMC4zMDkzMzU0IGwgLTIuMzdlLT' +\n    'UsLTEuMTcxMTQ2IDEuMDgyNzEwNSwtMTBlLTcgMC4wMTEsMS4xNzExNDYgaCAwLjMzMzMwNC' +\n    'BsIC0wLjAzNTA0LC0yLjU4NzMxNSBoIDAuNTc4MTI1IDAuNTc4MTI1IGwgMC4wMTEwNSwyLj' +\n    'U4NzMxNSBoIDAuMzU2MDI0IFYgMTIuMDYwNTQ3IEggMTQuMDYyNSB2IDAuOTc4NTE1IGggMC' +\n    '4zMzAwNzggdiAtMi41NTI3MzQgaCAxLjE1NjI1IHYgMi41NTI3MzQgaCAwLjk2Njc5NyB2ID' +\n    'AuMzU3NDIyIEggOS42ODM1OTM4IDguNTI3MzQzOCA3LjYwMzUxNTYgdiAtMC4zNTc0MjIgaC' +\n    'AwLjkyMzgyODIgeiIKICAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgID' +\n    'wvZz4KICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgIDwvZz4KICAgICAgICAgIDwvZz' +\n    '4KICAgICAgICA8L2c+CiAgICAgIDwvZz4KICAgIDwvZz4KICA8L2c+Cjwvc3ZnPgo=';\n\nBlockly.Css.register(`\n.blocklyBackpack {\n  opacity: 0.4;\n}\n.blocklyBackpackDarken {\n  opacity: 0.6;\n}\n.blocklyBackpack:active {\n  opacity: 0.8;\n}\n`);\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Typedefs and utility methods for parsing options for the\n * backpack plugin.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\n/**\n * @typedef {{\n *   emptyBackpack:(boolean|undefined),\n *   removeFromBackpack:(boolean|undefined),\n *   copyToBackpack:(boolean|undefined),\n *   copyAllToBackpack:(boolean|undefined),\n *   pasteAllToBackpack:(boolean|undefined),\n *   disablePreconditionChecks:(boolean|undefined)\n * }}\n */\nexport let BackpackContextMenuOptions;\n\n/**\n * @typedef {{\n *    allowEmptyBackpackOpen: (boolean|undefined),\n *    useFilledBackpackImage: (boolean|undefined),\n *    contextMenu:(!BackpackContextMenuOptions|undefined)\n * }}\n */\nexport let BackpackOptions;\n\n/**\n * Returns a new options object with all properties set, using default values\n * if not specified in the optional options that were passed in.\n * @param {BackpackOptions=} options The options to use.\n * @returns {!BackpackOptions} The created options object.\n */\nexport function parseOptions(options) {\n  const defaults = {\n    allowEmptyBackpackOpen: true,\n    useFilledBackpackImage: false,\n    contextMenu: {\n      emptyBackpack: true,\n      removeFromBackpack: true,\n      copyToBackpack: true,\n      copyAllToBackpack: false,\n      pasteAllToBackpack: false,\n      disablePreconditionChecks: false,\n    },\n  };\n\n  if (!options) {\n    return defaults;\n  }\n\n  return {\n    allowEmptyBackpackOpen:\n        options.allowEmptyBackpackOpen ?? defaults.allowEmptyBackpackOpen,\n    useFilledBackpackImage:\n        options.useFilledBackpackImage ?? defaults.useFilledBackpackImage,\n    contextMenu: {\n      ...defaults.contextMenu,\n      ...options.contextMenu,\n    },\n  };\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Helper and utility methods for the backpack plugin.\n * @author kozbial@google.com (Monica Kozbial)\n */\n\nimport * as Blockly from 'blockly/core';\nimport {BackpackContextMenuOptions} from './options';\nimport './msg';\n\n/**\n * Registers a context menu option to empty the backpack when right-clicked.\n * @param {!Blockly.WorkspaceSvg} workspace The workspace to register the\n *   context menu option on.\n */\nfunction registerEmptyBackpack(workspace) {\n  const prevConfigureContextMenu = workspace.configureContextMenu;\n  workspace.configureContextMenu = (menuOptions, e) => {\n    const backpack = workspace.getComponentManager().getComponent('backpack');\n    if (!backpack || !backpack.getClientRect().contains(e.clientX, e.clientY)) {\n      prevConfigureContextMenu &&\n      prevConfigureContextMenu.call(null, menuOptions, e);\n      return;\n    }\n    menuOptions.length = 0;\n    const backpackOptions = {\n      text: Blockly.Msg['EMPTY_BACKPACK'],\n      enabled: !!backpack.getCount(),\n      callback: function() {\n        backpack.empty();\n      },\n    };\n    menuOptions.push(backpackOptions);\n  };\n}\n\n/**\n * Registers a context menu option to remove a block from a backpack flyout.\n */\nfunction registerRemoveFromBackpack() {\n  if (Blockly.ContextMenuRegistry.registry.getItem('remove_from_backpack')) {\n    return;\n  }\n  const removeFromBackpack = {\n    displayText: Blockly.Msg['REMOVE_FROM_BACKPACK'],\n    preconditionFn: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      const ws = scope.block.workspace;\n      if (ws.isFlyout && ws.targetWorkspace) {\n        const backpack =\n            ws.targetWorkspace.getComponentManager().getComponent('backpack');\n        if (backpack && backpack.getFlyout().getWorkspace().id === ws.id) {\n          return 'enabled';\n        }\n      }\n      return 'hidden';\n    },\n    callback: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      const backpack =scope.block.workspace.targetWorkspace\n          .getComponentManager().getComponent('backpack');\n      backpack.removeBlock(scope.block);\n    },\n    scopeType: Blockly.ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'remove_from_backpack',\n    // Use a larger weight to push the option lower on the context menu.\n    weight: 200,\n  };\n  Blockly.ContextMenuRegistry.registry.register(removeFromBackpack);\n}\n\n/**\n * Registers context menu options for adding a block to the backpack.\n * @param {boolean} disablePreconditionContainsCheck Whether to disable the\n *   precondition check for whether the backpack contains the block.\n */\nfunction registerCopyToBackpack(disablePreconditionContainsCheck) {\n  if (Blockly.ContextMenuRegistry.registry.getItem('copy_to_backpack')) {\n    return;\n  }\n  const copyToBackpack = {\n    displayText: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      if (!scope.block) {\n        return;\n      }\n      const backpack = scope.block.workspace.getComponentManager()\n          .getComponent('backpack');\n      const backpackCount = backpack.getCount();\n      return `${Blockly.Msg['COPY_TO_BACKPACK']} (${backpackCount})`;\n    },\n    preconditionFn: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      const ws = scope.block.workspace;\n      if (!ws.isFlyout) {\n        const backpack = ws.getComponentManager().getComponent('backpack');\n        if (backpack) {\n          if (disablePreconditionContainsCheck) {\n            return 'enabled';\n          }\n          return backpack.containsBlock(scope.block) ? 'disabled' : 'enabled';\n        }\n      }\n      return 'hidden';\n    },\n    callback: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      const backpack =\n          scope.block.workspace.getComponentManager().getComponent('backpack');\n      backpack.addBlock(scope.block);\n    },\n    scopeType: Blockly.ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'copy_to_backpack',\n    // Use a larger weight to push the option lower on the context menu.\n    weight: 200,\n  };\n  Blockly.ContextMenuRegistry.registry.register(copyToBackpack);\n}\n\n/**\n * Registers context menu options for copying all blocks from the workspace to\n * the backpack.\n */\nfunction registerCopyAllBackpack() {\n  if (Blockly.ContextMenuRegistry.registry.getItem('copy_all_to_backpack')) {\n    return;\n  }\n  const copyAllToBackpack = {\n    displayText: Blockly.Msg['COPY_ALL_TO_BACKPACK'],\n    preconditionFn: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      const ws = scope.workspace;\n      if (!ws.isFlyout) {\n        const backpack = ws.getComponentManager().getComponent('backpack');\n        if (backpack) {\n          return 'enabled';\n        }\n      }\n      return 'hidden';\n    },\n    callback: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      const ws = scope.workspace;\n      const backpack = ws.getComponentManager().getComponent('backpack');\n      backpack.addBlocks(ws.getTopBlocks());\n    },\n    scopeType: Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'copy_all_to_backpack',\n    // Use a larger weight to push the option lower on the context menu.\n    weight: 200,\n  };\n  Blockly.ContextMenuRegistry.registry.register(copyAllToBackpack);\n}\n\n/**\n * Registers context menu options for pasting all blocks from the backpack to\n * the workspace.\n */\nfunction registerPasteAllBackpack() {\n  if (Blockly.ContextMenuRegistry.registry.getItem('paste_all_from_backpack')) {\n    return;\n  }\n  const pasteAllFromBackpack = {\n    displayText: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      if (!scope.workspace) {\n        return;\n      }\n      const backpack =\n          scope.workspace.getComponentManager().getComponent('backpack');\n      const backpackCount = backpack.getCount();\n      return `${Blockly.Msg['PASTE_ALL_FROM_BACKPACK']} (${backpackCount})`;\n    },\n    preconditionFn: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      const ws = scope.workspace;\n      if (!ws.isFlyout) {\n        const backpack = ws.getComponentManager().getComponent('backpack');\n        if (backpack) {\n          return 'enabled';\n        }\n      }\n      return 'hidden';\n    },\n    callback: function(\n        /** @type {!Blockly.ContextMenuRegistry.Scope} */ scope) {\n      const ws = scope.workspace;\n      const backpack = ws.getComponentManager().getComponent('backpack');\n      const contents = backpack.getContents();\n      contents.forEach((blockText) => {\n        const block =\n            Blockly.Xml.domToBlock(Blockly.Xml.textToDom(blockText), ws);\n        block.scheduleSnapAndBump();\n      });\n    },\n    scopeType: Blockly.ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'paste_all_from_backpack',\n    // Use a larger weight to push the option lower on the context menu.\n    weight: 200,\n  };\n  Blockly.ContextMenuRegistry.registry.register(pasteAllFromBackpack);\n}\n\n/**\n * Register all context menu options.\n * @param {!BackpackContextMenuOptions} contextMenuOptions The backpack context\n *    menu options.\n * @param {!Blockly.WorkspaceSvg} workspace The workspace to register the\n *    context menu options.\n */\nexport function registerContextMenus(contextMenuOptions, workspace) {\n  if (contextMenuOptions.emptyBackpack) {\n    registerEmptyBackpack(workspace);\n  }\n  if (contextMenuOptions.removeFromBackpack) {\n    registerRemoveFromBackpack();\n  }\n  if (contextMenuOptions.copyToBackpack) {\n    registerCopyToBackpack(\n        contextMenuOptions.disablePreconditionChecks);\n  }\n  if (contextMenuOptions.copyAllToBackpack) {\n    registerCopyAllBackpack();\n  }\n  if (contextMenuOptions.pasteAllToBackpack) {\n    registerPasteAllBackpack();\n  }\n}\n\n/**\n * Converts XML representing a block into text that can be stored in the\n * content array.\n * @param {!Element} xml An XML tree defining the block and any\n *    connected child blocks.\n * @returns {string} Text representing the XML tree, cleaned of all unnecessary\n * attributes.\n */\nexport function cleanBlockXML(xml) {\n  const xmlBlock = xml.cloneNode(true);\n  let node = xmlBlock;\n  while (node) {\n    // Things like text inside tags are still treated as nodes, but they\n    // don't have attributes (or the removeAttribute function) so we can\n    // skip removing attributes from them.\n    if (node.removeAttribute) {\n      node.removeAttribute('x');\n      node.removeAttribute('y');\n      node.removeAttribute('id');\n      node.removeAttribute('disabled');\n      if (node.nodeName == 'comment') {\n        node.removeAttribute('h');\n        node.removeAttribute('w');\n        node.removeAttribute('pinned');\n      }\n    }\n\n    // Try to go down the tree\n    let nextNode = node.firstChild || node.nextSibling;\n    // If we can't go down, try to go back up the tree.\n    if (!nextNode) {\n      nextNode = node.parentNode;\n      while (nextNode) {\n        // We are valid again!\n        if (nextNode.nextSibling) {\n          nextNode = nextNode.nextSibling;\n          break;\n        }\n        // Try going up again. If parentNode is null that means we have\n        // reached the top, and we will break out of both loops.\n        nextNode = nextNode.parentNode;\n      }\n    }\n    node = nextNode;\n  }\n  return Blockly.Xml.domToText(xmlBlock);\n}\n"],"names":["root","factory","exports","module","require","define","amd","a","i","this","__WEBPACK_EXTERNAL_MODULE__573__","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","d","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","r","Symbol","toStringTag","value","Blockly","BACKPACK_OPEN","BackpackOpen","isOpen","workspaceId","type","json","BACKPACK_CHANGE","BackpackChange","Backpack","targetWorkspace","backpackOptions","options","defaults","workspace_","id","options_","allowEmptyBackpackOpen","useFilledBackpackImage","contextMenu","emptyBackpack","removeFromBackpack","copyToBackpack","copyAllToBackpack","pasteAllToBackpack","disablePreconditionChecks","flyout_","contents_","boundEvents_","left_","top_","WIDTH_","HEIGHT_","MARGIN_VERTICAL_","MARGIN_HORIZONTAL_","HOTSPOT_MARGIN_","svgGroup_","SPRITE_TOP_","SPRITE_LEFT_","SPRITE_SIZE_","contextMenuOptions","workspace","getComponentManager","addComponent","component","weight","capabilities","initFlyout_","createDom_","attachListeners_","prevConfigureContextMenu","configureContextMenu","menuOptions","e","backpack","getComponent","getClientRect","contains","clientX","clientY","length","text","enabled","getCount","callback","empty","push","registerEmptyBackpack","displayText","preconditionFn","scope","ws","block","isFlyout","getFlyout","getWorkspace","removeBlock","scopeType","registerRemoveFromBackpack","disablePreconditionContainsCheck","backpackCount","containsBlock","addBlock","registerCopyToBackpack","addBlocks","getTopBlocks","registerCopyAllBackpack","pasteAllFromBackpack","getContents","forEach","blockText","scheduleSnapAndBump","registerPasteAllBackpack","initialized_","resize","event","flyoutWorkspaceOptions","RTL","oneBasedIndex","renderer","rendererOverrides","horizontalLayout","toolboxPosition","HorizontalFlyout","VerticalFlyout","getParentSvg","parentNode","appendChild","createDom","init","rnd","clip","svgImg_","setAttributeNS","BACKPACK_SVG_DATAURI","getBubbleCanvas","addEvent_","blockMouseDownWhenOpenable_","onClick_","onMouseOver_","onMouseOut_","node","name","thisObject","func","clientRect","getBoundingClientRect","top","bottom","left","right","metrics","savedPositions","hasVerticalScrollbars","scrollbar","canScrollHorizontally","hasHorizontalScrollbars","canScrollVertically","toolboxMetrics","position","absoluteMetrics","viewMetrics","width","startAtBottom","height","otherEl","boundingRect","getBoundingRectangle","intersects","setAttribute","dragElement","xml","xmlBlock","cloneNode","removeAttribute","nodeName","nextNode","firstChild","nextSibling","cleanBlockXML","cleanedBlockXml","blockToCleanXmlString_","indexOf","addItem","blocks","cleanedBlocks","map","addItems","removeItem","item","items","addedItems","filterDuplicates_","unshift","onContentChange_","itemIndex","splice","contents","close","maybeRefreshFlyoutContents_","BACKPACK_FILLED_SVG_DATAURI","array","filter","idx","isVisible","isOpenable_","show","hide","onlyClosePopups","open","uiEvent","updateHoverStying_","_dragElement","addClass","backpackDarken","stopPropagation"],"sourceRoot":""}